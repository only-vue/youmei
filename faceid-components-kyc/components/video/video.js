"use strict";function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var _request=require("../_utils/request"),request=_interopRequireWildcard(_request),_actions=require("../../tools/actions"),Action=_interopRequireWildcard(_actions),_const=require("../_utils/const");Component({properties:{token:{type:String,value:null},number:{type:String,value:null}},data:{numbers:["-","-","-","-"],message:"",disabled:!0,show_exit_btn:!0,show_action_btn:!0,action_btn_text:"",timer:_const.TIMER_COUNT,finished:!1},created:function(){this.base=this.selectComponent("#base"),this.result_code="",this.result=null},ready:function(){this.data.number&&4===this.data.number.length?(this.setData({numbers:this.data.number.split("")}),this._countTimer()):this._getUserInfo(),this.setData({main_width:wx.getStorageSync("video_bg_width")})},attached:function(){},methods:{_countTimer:function(){var t=this,e=t.data.timer;setTimeout(function(){e-=1,t.setData({disabled:e>0,timer:e>0?e:_const.TIMER_COUNT}),e>0&&t._countTimer()},1e3)},_getUserInfo:function(){var t=this;request.getUserInfo(t.data.token).then(function(e){var i=e.code;t.setData({numbers:i.split("")}),t.result_code=e.result_message,t._countTimer()},function(){Action.ExitLite({token:t.data.token,status:"tokenError"})})},onStart2Record:function(){var t=this;Action.chooseVideo({checkSize:!0,checkDuration:!0}).then(function(e){request.verifyVideo({filePath:e,data:{biz_token:t.data.token}},t.base).then(function(){t.base.callExitLite()}).catch(function(e){if(["FINISHED","PROCESS_ERROR"].indexOf(e.result_code)>-1)return void t.base.callExitLite(e.result_code);if(e&&e.data){var i=e.data;i&&i.code&&t.setData({numbers:i.code.split("")})}t.base.showModal(e.result_code)})}).catch(function(e){t.base.showModal(e&&e.codeText)})}}});