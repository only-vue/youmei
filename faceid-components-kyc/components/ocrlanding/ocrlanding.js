"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var _request=require("../_utils/request"),request=_interopRequireWildcard(_request),_actions=require("../../tools/actions"),Action=_interopRequireWildcard(_actions),_const=require("../_utils/const");Component({properties:{token:{type:String,value:null},side:{type:String,value:"front"},errorCode:{type:String,value:null}},data:{fileuploaded:!1,has_retry_times:!0},attached:function(){},ready:function(){this.base=this.selectComponent("#base"),this.data.errorCode&&this.base.showModal(this.data.errorCode)},methods:{onNext:function(){this.triggerEvent("nextstep")},onTakePhoto:function(){var e=this.data.side,t=this;Action.chooseImage().then(function(r){var a={data:{side:"front"===e?0:1,biz_token:t.data.token},filePath:r};request.getOCRVerifyResult(a,t.base).then(function(r){t.setData({fileuploaded:!0,has_retry_times:r["idcard_"+e+"_retry_time"]>0}),"front"===e?(wx.setStorageSync("name",r.name),wx.setStorageSync("idcard_number",r.idcard_number),wx.setStorageSync("image_ref_ocridcardfront","data:image/jpeg;base64,"+r.idcard_cropped_front),wx.setStorageSync("idcard_front_retry_time",r.idcard_front_retry_time)):(wx.setStorageSync("issued_by",r.issued_by),wx.setStorageSync("valid_date",r.valid_date_start+"-"+r.valid_date_end),wx.setStorageSync("image_ref_ocridcardback","data:image/jpeg;base64,"+r.idcard_cropped_back),wx.setStorageSync("idcard_back_retry_time",r.idcard_back_retry_time));var a="front"===t.data.side?_const.STEP_TO.ocridcardfront:_const.STEP_TO.ocridcardback;t.triggerEvent("nextstep",{nextStep:a})}).catch(function(r){["FINISHED","PROCESS_ERROR"].indexOf(r.result_code)>-1?t.base.callExitLite(r.result_code):r&&r.data["idcard_"+e+"_retry_time"]<=0?t.base.callExitLite():t.base.showModal(r.result_code)})})}}});