"use strict";function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var _actions=require("../../tools/actions"),Action=_interopRequireWildcard(_actions),_request=require("../_utils/request"),request=_interopRequireWildcard(_request),_const=require("../_utils/const");Component({externalClasses:["video-class","header-class","body-class"],options:{multipleSlots:!0},properties:{step:{type:Number,value:_const.STEP_TO.landing},token:{type:String,value:null}},created:function(){this.verifyModal=this.selectComponent("#verify-modal")},ready:function(){this.setData({landing_ocr_width:wx.getStorageSync("landing_ocr_width")})},attached:function(){},data:{message:"",show_exit_btn:!1,show_action_btn:!1,action_btn_text:""},methods:{onExit:function(){this.showModal("EXIT")},showModal:function(t){var e=_const.EXIT_CODE_LIST.indexOf(t)>-1;this.setData({show_exit_btn:e}),this.verifyModal.showModal({message:(0,_const.getErrorMessageByResultCode)(t),action_btn_text:(0,_const.getActionButtonText)(t)})},showLoading:function(t){t=t?(0,_const.getErrorMessageByResultCode)(t):"",this.verifyModal.showLoading({title:t})},hideModal:function(){this.verifyModal.hideModal()},onContinue:function(){this.verifyModal.hideModal()},onFinish:function(){this.verifyModal.hideModal();var t=this;request.cancel(this.data.token,this.showLoading.bind(this,"FINISHING"),this.hideModal.bind(this)).then(function(){t.callExitLite()},function(e){"PROCESS_ERROR"==e.result_code?t.callExitLite(e.result_code):t.showModal("CANCEL_FAILURE")})},callExitLite:function(t){var e=this,i={token:e.data.token,status:"complete"};t&&"PROCESS_ERROR"==t&&(i=Object.assign(i,{status:"tokenError"})),Action.ExitLite(i).then(function(){e.setData({finished:!0})})},onTakePhoto:function(){var t=this;Action.chooseImage().then(function(e){t.triggerEvent("uploadfile",{filePath:e})})}}});